<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>URL Scan Result</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    body {
        background: #0b0b0b;
        font-family: "JetBrains Mono", monospace;
        color: #c7fba5;
        margin: 0;
    }
    .container {
        width: 85%;
        margin: 30px auto;
        background: #131313;
        border: 1px solid #523874;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 0 22px #523874aa;
    }
    h1 {
        text-align: center;
        color: #adf182;
        margin-top: 10px;
    }

    .section-title {
        font-size: 20px;
        color: #916cad;
        border-bottom: 1px solid #523874;
        margin-top: 25px;
        padding-bottom: 5px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 12px;
    }
    table th, table td {
        border-bottom: 1px solid #333;
        padding: 8px 12px;
        text-align: left;
    }
    table th {
        color: #dc7d68;
    }

    .badge {
        padding: 10px 20px;
        display: inline-block;
        font-size: 20px;
        margin: 10px auto 20px;
        border-radius: 10px;
        font-weight: bold;
        color: white;
    }

    .malicious { background:#8b0000; }
    .suspicious { background:#cc8400; }
    .clean { background:#0f8b32; }

    .stat-grid {
        display: flex;
        gap: 15px;
        margin-top: 10px;
    }
    .stat-box {
        flex: 1;
        padding: 15px;
        background: #1a1a1a;
        text-align: center;
        border-radius: 10px;
        border: 1px solid #523874;
    }
    .stat-num {
        font-size: 26px;
        font-weight: bold;
        color: #adf182;
    }
    .stat-label {
        color: #916cad;
    }

    .result-cell.malicious { color:#ff4d4d; font-weight:bold; }
    .result-cell.suspicious { color:#ffae42; font-weight:bold; }
    .result-cell.clean { color:#7cff6b; font-weight:bold; }
    .result-cell.harmless { color:#999; font-weight:bold; }

    /* BACK BUTTON STYLE */
    .back-btn {
        display: inline-block;
        padding: 10px 20px;
        background: #523874;
        color: #c7fba5;
        text-decoration: none;
        font-weight: bold;
        border-radius: 8px;
        transition: 0.2s ease;
        box-shadow: 0 0 12px #523874aa;
    }
    .back-btn:hover {
        background: #6a46a5;
        color: white;
        box-shadow: 0 0 18px #6a46a5ff;
    }
</style>
</head>

<body>

<div class="container">

<!-- ðŸ”¥ BACK BUTTON AT TOP -->
<div style="text-align:left; margin-bottom:10px;">
    <a href="/" class="back-btn">â¬… Back</a>
</div>

<h1>URL Scan Result</h1>

<!-- Categorization -->
{% set malicious = [] %}
{% set suspicious = [] %}
{% set clean = [] %}
{% set harmless = [] %}

{% for engine, info in vt_result.items() %}
    {% if info.result == "malicious" %}
        {% set _ = malicious.append(1) %}
    {% elif info.result == "suspicious" %}
        {% set _ = suspicious.append(1) %}
    {% elif info.result == "harmless" %}
        {% set _ = harmless.append(1) %}
    {% else %}
        {% set _ = clean.append(1) %}
    {% endif %}
{% endfor %}

<!-- Badge -->
{% if malicious|length > 0 %}
<div class="badge malicious">âš  MALICIOUS</div>
{% elif suspicious|length > 0 %}
<div class="badge suspicious">âš  SUSPICIOUS</div>
{% else %}
<div class="badge clean">âœ” CLEAN</div>
{% endif %}

<!-- Stats -->
<div class="stat-grid">
    <div class="stat-box">
        <div class="stat-num">{{ malicious|length }}</div>
        <div class="stat-label">Malicious</div>
    </div>
    <div class="stat-box">
        <div class="stat-num">{{ suspicious|length }}</div>
        <div class="stat-label">Suspicious</div>
    </div>
    <div class="stat-box">
        <div class="stat-num">{{ clean|length }}</div>
        <div class="stat-label">Clean</div>
    </div>
    <div class="stat-box">
        <div class="stat-num">{{ harmless|length }}</div>
        <div class="stat-label">Harmless</div>
    </div>
</div>

<!-- PIE CHART -->
<h2 class="section-title">Detection Summary</h2>

<div style="width:230px; height:230px; margin: 0 auto;">
    <canvas id="pieChart"></canvas>
</div>

<script>
new Chart(document.getElementById("pieChart"), {
    type: "pie",
    data: {
        labels: ["Malicious", "Suspicious", "Clean", "Harmless"],
        datasets: [{
            data: [
                {{ malicious|length }},
                {{ suspicious|length }},
                {{ clean|length }},
                {{ harmless|length }}
            ]
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false
    }
});
</script>

<!-- TABLE -->
<h2 class="section-title">Engine Results</h2>

<table class="engine-table">
    <thead>
        <tr>
            <th>Engine</th>
            <th>Category</th>
        </tr>
    </thead>
    <tbody>
        {% for engine, info in vt_result.items() %}
        <tr>
            <td>{{ info.engine_name }}</td>
            <td class="result-cell {{ info.result }}">{{ info.result }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

</div>

</body>
</html>
